<!DOCTYPE html>
<html lang="en">
    <!--
    HTML5 documentation:
    http://www.w3.org/html/wg/drafts/html/master/
    http://www.w3.org/TR/2010/WD-html5-20100624/
    http://dev.w3.org/html5/html-author/
    
    Documentation on properties of HTA:APPLICATION: 
    http://www.htmlgoodies.com/beyond/reference/article.php/3472841/HTML-Applications.htm
    http://msdn.microsoft.com/library/default.asp?url=/workshop/author/hta/overview/htaoverview.asp
    
    It's possible to pack all the resources into a single executable with a custom icon using WinRAR:
    http://stackoverflow.com/questions/4592410/is-it-possible-to-add-custom-icon-to-hta
    http://www.rarlab.com/shop2rarlab-index.php?prod=winrar&x-source=winraronly
    
    <h1>Credits</h1>
    <p>Javascript libraries <a href="http://prototypejs.org/" target="_blank">prototype.js</a> (<a href="http://prototypejs.org/license.html" target="_blank">MIT License</a>), <a href="http://script.aculo.us/" target="_blank">scriptaculous.js</a> (<a href="http://madrobby.github.io/scriptaculous/license/" target="_blank">MIT License</a>), <a href="http://livepipe.net/" target="_blank">livepipe.js</a> (<a href="http://livepipe.net/#MIT" target="_blank">MIT License</a>), and <a href="https://github.com/atetlaw/Really-Easy-Field-Validation" target="_blank">validation</a> (<a href="http://opensource.org/licenses/MIT" target="_blank">MIT License</a>).</p>
    http://ajaxload.info/  for the ajax loading icon. license: "generated gifs are totally free for use"
    
    -->
    <head>
        <title>Asset Tag Reference Implementation</title>
        <meta name="application-name" content="Mt Wilson Asset Tag Reference Implementation"/>
        <meta name="description" content="A web-based tool for defining tags and provisioning asset certificates" />
        <meta name="keywords" content="Mt Wilson, attestation, asset, inventory, management, security, cloud, data center" />
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />

        <!--
    <HTA:APPLICATION ID="oMyApp" 
        APPLICATIONNAME="Mystery Hill Demo" 
        BORDER="yes"
        BORDERSTYLE="normal"
        innerBorder="yes"
        navigable="yes"
        CAPTION="yes"
        SHOWINTASKBAR="yes"
        SINGLEINSTANCE="yes"
        maximizeButton="yes"
        minimizeButton="yes"
        SYSMENU="yes"
        SCROLL="auto"
        scrollFlat="no"
        ICON="intel-logo-blue-transparent-160x121.ico"
        WINDOWSTATE="maximize"/>
        -->
        <link rel="resources" type="application/vnd.mtwilson.resource+json" href="/resources.json">
        
        <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
        <!--
        <link rel="stylesheet" href="images/MarketPlace.css" type="text/css" />
        <link rel="stylesheet" href="morestyle.css" type="text/css" />
        -->
        <link rel="stylesheet" href="images/at.css" type="text/css" />

        <!--		<script src="ie-settimeout.js" type="text/javascript"><script> -->
        <script src="watch.js" type="text/javascript"></script> <!-- required to use rivets -->
        <script src="prototype-1.7.1.js" type="text/javascript"></script> <!-- required by log.js -->
        <!-- ui tools -->
        <script src="scriptaculous-1.9.0/scriptaculous.js" type="text/javascript"></script> 
        <script src="livepipe/livepipe.js" type="text/javascript"></script>
        <script src="livepipe/contextmenu.js" type="text/javascript"></script>
        <script src="livepipe/cookie.js" type="text/javascript"></script>
        <script src="livepipe/event_behavior.js" type="text/javascript"></script>
        <script src="livepipe/hotkey.js" type="text/javascript"></script>
        <script src="livepipe/progressbar.js" type="text/javascript"></script>
        <script src="livepipe/rating.js" type="text/javascript"></script>
        <script src="livepipe/resizable.js" type="text/javascript"></script>
        <script src="livepipe/scrollbar.js" type="text/javascript"></script>
        <script src="livepipe/selection.js" type="text/javascript"></script>
        <script src="livepipe/selectmultiple.js" type="text/javascript"></script>
        <script src="livepipe/tabs.js" type="text/javascript"></script>
        <script src="livepipe/textarea.js" type="text/javascript"></script>
        <script src="livepipe/window.js" type="text/javascript"></script>
        <script src="URI.js" type="text/javascript"></script>
        <script src="validation.js" type="text/javascript"></script>
        <script src="input.js" type="text/javascript"></script>
        <script src="array.js" type="text/javascript"></script>
        <script src="merge.js" type="text/javascript"></script>
        <script src="date.js" type="text/javascript"></script> <!-- required by log.js -->
        <script src="log.js" type="text/javascript"></script> <!-- requires prototype.js, date.js -->
        <script src="form.js" type="text/javascript"></script>
        <script src="rivets.js" type="text/javascript"></script>
        <script src="findx.js" type="text/javascript"></script>
        <script src="rivets-adapter-watch-findx.js" type="text/javascript"></script> <!-- requires rivets, watch.js, and findx -->
        <!-- mdv -->
        <!-- this one uses template tags, but cannot get it to work in 5 minutes so switching to rivets
        <script src="Template-instantiation-stable/mdv.js" type="text/javascript"></script> -->

        <script src="base64.js" type="text/javascript"></script>
        <script src="ajax.js" type="text/javascript"></script>
        <script src="atclient.js" type="text/javascript"></script>

        <!-- sample data for testing -->
        <!-- script src="sampledata.js" type="text/javascript"></script -->


        <script type="text/javascript">
            var ws = mtwilson.atag; // local name for the asset tag web service
        </script>

        <script type="text/javascript">
// credit for isNumber (creative commons share alike 3.0) http://stackoverflow.com/questions/18082/validate-numbers-in-javascript-isnumeric/1830844#1830844
function isNumber(n) {
  return !isNaN(parseFloat(n)) && isFinite(n);
}            
            
            // watch adapter, from https://github.com/mikeric/rivets/wiki/Adapters
            rivets.configure({
                adapter: rivets_watch_findx_adapter,
                prefix: 'bind' // so data binding happens for data-bind-whatever attributes (instead of data-whatever) ; which allows us to use input.js because it uses data-alt.
                /*
                binders: {
                    'alt': function(el,value) { } // do nothing; this allows input.js to continue using data-alt for its default display text. another way to do it would be to use the 'prefix' configuration of rivets like  prefix:'bind' and then use data-bind-whatever instead of just data-whatever in the forms.
                }
                 */
            });
            
            // input like timestamp 1377839054000 or text date format like yyyy-MM-dd, output like:  2013-08-30T05:04:14.000Z
                rivets.formatters.isodate = function(value) {
                        if( isNumber(value) ) {
                            return new Date(value).toISOString();
                        }
                        else {
                            return Date.parse(value).toISOString();
                        }
                    };
                rivets.formatters.date = function(value) {
                        if( isNumber(value) ) {
                            return new Date(value).toString();
                        }
                        else {
                            return Date.parse(value).toString();
                        }
                    };
                    // input any value that evaluates to true/false, output either "yes" or "no" or replace those with your own "yes value" and "no value" for example "Active" and "Inactive" instead of "yes" and "no"
               rivets.formatters.yesno = function(value,yestext,notext) {
                   if( value ) {
                       return yestext ? yestext : "yes";
                   }
                   else {
                       return notext ? notext : "no";
                   }
               };
               // input any hex or base64 value and this will return the value with newlines inserted
               rivets.formatters.wrap = function(text,columns,sep) {
                   var i=0, result="";
                   columns = columns ? parseInt(columns) : 20;
                   sep = sep || " ";
                   log.debug("wrap text: "+text+"  length: "+text.length+"  columns: "+columns);
                   while(i<text.length) { result += text.slice(i,i+columns) + sep; i += columns; }
                   log.debug("wrap result: "+Object.toJSON(result));
                   return result;
               };
               
//                }
            
        </script>

    </head>
    <body>
        <!-- wrap starts here -->
        <div id="wrap">

            <!--header -->
            <div id="header">			

                <div id="header-links">
                    <p>
                        <a href="http://www.intel.com" target="_blank">Intel</a> | 
                        <a href="http://http://cloudsecurityportal.intel.com/" target="_blank">Mt Wilson</a>
                    </p>		
                </div>		

                <div id="header-caption">
                    <h1>Asset Tag Reference Implementation</h1>
                </div>

                <!--header ends-->					
            </div>

            <!-- navigation starts-->	
            <nav id="nav">
                <ul id="navtabs"> <!-- put  id="current"  on the li tag that is currently displayed -->
                    <li class="tab"><a href="#tags">Tags</a></li>  <!-- red color:  style="color: #c55" -->
                    <li class="tab"><a href="#rdf">RDF</a></li>			
                    <li class="tab"><a href="#selections">Selection</a></li>
                    <li class="tab"><a href="#certificates">Certificates</a></li>			
                    <li class="tab"><a href="#configure">Configure</a></li>
                    <li class="tab"><a href="#log">Log</a></li>
                </ul>
                <!-- navigation ends-->	
            </nav>				
            <div id="ajaxstatus" style="clear: both; width: 840px; height: 20px; max-height: 50px;  margin-top: 0px; padding: 4px;">
            </div>
            <!--
            <div id="notifications" style="clear: both; width: 840px; height: 20px; max-height: 50px;  margin-top: 0px; padding: 4px;">
                <ul style="margin-left: 0px; padding-left: 0px; list-style: none;">
                    <li style="border: 1px solid black; border-radius: 3px; padding-left: 5px; padding-right: 5px; margin: 3px;" data-bind-each-item="notices"><span data-bind-text="item.text"></span> <a href="#" style="color: black; font-weight: bold;" onclick="javascript:$(this).up('li').remove();">X</a></li>                    
                </ul>
            </div>
            -->

            <!-- content-wrap starts -->
            <div id="content-wrap" class="one-col"  >	

                <div id="main">

                    <div id="tags">
                        <h1>Tag Management</h1>


                        <h2>Create New Tag</h2>
                        <!-- load the "create new tag" form ... XXX TODO need to try onload="" here with
                        automatically adding stylesheets and scripts to the form document. -->
                        <script>
                            function showCreateTagForm() {
                                // XXX TODO use ajax to load /forms/tags/create-tag.html, 
                                // create a new div centered on the page, set the inner html
                                // of the div to the content of the body element from create-tag.html 
                                // and set the action of the form $$('#mydivname form')[0].onsubmit="ws.createTag(this);"
                                // so that i can get the submissions and handle them as i already do now.
                                var myform = $('createtagform111');
                                if( myform ) {
                                    log.debug("form already exists, showing it");
                                    myform.show();
                                }
                                else {
                                log.debug("getting new tag form");
                                new Ajax.Request('/forms/tags/create-tag.html', {
            method: 'get',
            //parameters: {},
            onSuccess: function (transport) {
                var response = transport.responseText || "no response text";
                log.debug("Success! \n\n" + response);
//                var tmp = $(response);
                var tmp = new Element('div');
                tmp.update(response);
                log.debug("got a tmp element: "+tmp);
                var formbody = tmp.select("form")[0];
                var myform = $(formbody);
                myform.id = "createtagform111";
                myform.setStyle({position: "absolute", top: "50px", left: "50px", backgroundColor: "#fff", zIndex: 10});
                log.debug("got a form body: "+myform);
                log.debug("adding to dom...");
//                document.select("body")[0].insert({bottom:formbody});
                $$("body")[0].insert({bottom:myform});
                log.debug("added!");
                tmp.remove();
                log.debug("removed the div");
                /*
                var tmp = document.createElement("div");
                tmp.innerHTML = response;
                tmp.setAttribute("style", "display: none;");
                log.debug("going to add it to the page");
                $(document).insert({bottom:tmp});
                log.debug("now changing innerhtml");
                var formbody = $(tmp).select("body")[0].innerHTML;
                tmp.innerHTML = formbody;
                tmp.id = "createtagform111";
                tmp.setAttribute("style", "text-align:center;");
                log.debug("now showing");
                $('createtagform111').show();
        */
            }
        });
                            }
                            }
                            </script>
                        <a href="javascript:showCreateTagForm();">create tag</a>

                        <h2>Search Tags</h2>

                        <form id="tag-search-form" action="#" onsubmit="return false;">
                            <ul>
                                <li>
                                    <label for="tag-search-name">Tag name</label>
                                    <select id="tag-search-name-criteria">
                                        <option value="EqualTo">is</option>
                                        <option value="Contains">contains</option>
                                    </select>
                                    <input type="text" id="tag-search-name" name="name" placeholder="Tag name"/>
                                </li>
                                <li>
                                    <label for="tag-search-oid">Tag OID</label>
                                    <select id="tag-search-oid-criteria">
                                        <option value="EqualTo">is</option>
                                        <option value="StartsWith">starts with</option>
                                    </select>
                                    <input type="text" id="tag-search-oid" name="oid" placeholder="Tag OID"/>
                                </li>
                                <li>
                                    <label for="tag-search-value">Tag value</label>
                                    <select id="tag-search-value-criteria">
                                        <option value="EqualTo">is</option>
                                        <option value="Contains">contains</option>
                                    </select>
                                    <input type="text" id="tag-search-value" name="value" placeholder="Tag value"/>
                                </li>
                                <!--
                                <li>
                                    <label for="tag-search-description">Tag description</label>
                                    <select id="tag-search-description-criteria">
                                        <option>contains</option>
                                        <option>is</option>
                                    </select>
                                    <input type="text" id="tag-create-description" name="oid"/>
                                </li>
                                -->
                                <li><input type="button" value="Search..." onclick="ws.searchTags(this); return false;"/></li>
                            </ul>
                        </form>

                        <h2>Browse Tags</h2>

                        <table id="tag-browse-table" class="dataview">
                            <caption>Tags</caption>
                            <thead>
                                <tr>
                                    <th>Tag name</th>
                                    <th>Tag OID</th>
                                    <!-- <th>Description</th> -->
                                    <th>Tag values</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <td colspan="4">
                                        <a href="#">&lt; prev</a> | <a href="#">next 10 &gt;</a>
                                        view&nbsp;<a href="#">5</a>&nbsp;<a href="#">10</a>&nbsp;<a href="#">25</a>&nbsp;<a href="#">50</a>&nbsp;<a href="#">100</a>&nbsp;per page
                                    </td></tr>
                            </tfoot>
                            <tbody>
                                <tr data-bind-each-item="tags">
                                    <td data-bind-text="item.name"></td>
                                    <td data-bind-text="item.oid"></td>
                                    <td style="max-width: 400px;">
                                        <ul style="margin-left: 0px; padding-left: 0px; list-style: none;">
                                            <li style="display: inline-block; list-style-type: inline; border: none; padding: 1px; margin: 3px;" data-bind-each-item="item.values"><span style="text-decoration: underline;" data-bind-text="item"></span></li>
                                        </ul>
                                    </td>
                                    <td><a data-bind-oid="item.oid" data-bind-uuid="item.uuid"  href="#" onclick="javascript:ws.removeTag(this.getAttribute('uuid')); return false;">delete</a></td>
                                </tr>
                            </tbody>
                        </table>


                        <!-- end tags tab  -->
                    </div>

                    <div id="selections">
                        <h1>Tag Selection</h1>

                        <h2>Create New Tag Selection</h2>
                        <script>
                            function selection_create_form_init() {
                                log.debug("selection_create_form_init: rivets forms: "+Object.toJSON(mtwilson.rivets.forms['selection-create-form'].input));
//                                if( mtwilson.rivets.forms['selection-create-form'] ) {
                                    log.debug("selection_create_form_init: got selection-create-form");
                                    log.debug("selection_create_form_init: current tag data is: "+Object.toJSON(mtwilson.atag.data.tags));
                                    mtwilson.rivets.forms['selection-create-form'].input.name = ''; // TODO should use automatic binding to form element... don't know why that isn't working.
                                    mtwilson.rivets.forms['selection-create-form'].tagValues = [];
//                                    mtwilson.rivets.forms['selection-create-form'].tags = mtwilson.atag.data.tags; // already part of global binding
                                    mtwilson.rivets.forms['selection-create-form'].input.selection = [];
                                    // and initialize the second select box with values of the first tag
                                    log.debug("current value: "+getSelectOptionValue('selection-create-tags-select')); // too early... ui update didn't happen yet
                                    selection_create_form_onSelectTag( getSelectOptionValue('selection-create-tags-select') );
//                                }                                
                            }
                            function selection_create_form_onSelectTag(tagId) {
                                log.debug("selection_create_form_onSelectTag: selected tag id: "+tagId);
                                var tag = ws.findTagByOid(tagId);
                                log.debug("selection_create_form_onSelectTag: found tag: "+Object.toJSON(tag));
//                                log.debug("selection_create_form_onSelectTag: rivets forms: "+Object.toJSON(mtwilson.rivets.forms['selection-create-form']));
                                mtwilson.rivets.forms['selection-create-form'].tagValues.clear().merge(tag.values); 
                            }
                            
                            function selection_create_form_addValue() {
                                var tag = ws.findTagByOid(getSelectOptionValue('selection-create-tags-select'));
                                var tagValue = $F('selection-create-tags-values');
                                mtwilson.rivets.forms['selection-create-form'].input.selection.push({ tag:tag, value: tagValue});  // XXX tag should be uuid? oid? name? just need an id, not the whole object. maybe put the whole object here to make it easy and just pick out what we need to send to the server when it's time to submit the selection.
                                log.debug("added tag ("+tag.oid+","+tagValue+") to selection: "+Object.toJSON(mtwilson.rivets.forms['selection-create-form'].input.selection));
                            }
                            function selection_create_form_removeValue(tagOid,tagValue) {
                                var i = mtwilson.rivets.forms['selection-create-form'].input.selection.length;
                                log.debug("looking through "+i+" selections for value to remove: ("+tagOid+","+tagValue+")");
                                while(i--) {
                                    if( mtwilson.rivets.forms['selection-create-form'].input.selection[i].tag.oid == tagOid &&  mtwilson.rivets.forms['selection-create-form'].input.selection[i].value == tagValue ) {
                                        mtwilson.rivets.forms['selection-create-form'].input.selection.splice(i,1);
                                    }
                                }
                                log.debug("removed tag ("+tagOid+","+tagValue+") from selection: "+Object.toJSON(mtwilson.rivets.forms['selection-create-form'].input.selection));
                                mtwilson.rivets.views['selection-create-form'].sync(); // XXX TODO the watch.js is supposed to detect the change in the array and the rivets-adapter-watach-findx would then call sync... but it doesn' thappen so we have to call sync() ourselves
                            }
                            // called when submitting the form... checks that at least one value was added
                            function selection_create_form_validateValues() {
                                return mtwilson.rivets.forms['selection-create-form'].input.selection.length > 0;
                            }
                            
                        </script>
                        <form id="selection-create-form" action="#" onsubmit="return false;">
                            <ul>
                                <li><label for="selection-create-name">Name</label><input type="text" id="selection-create-name" name="name" data-bind-value="input.name" placeholder="Name of this selection" class="required"/></li>
                                <!-- XXX TODO future release should add a host selection here too:  so selection is list of selected tags and (optional) list of selected hosts to apply them to -->
                                <li><label for="selection-create-tags-select">Tags</label>
                                    <select id="selection-create-tags-select" onchange="selection_create_form_onSelectTag(getSelectOptionValue(this.id));">
                                        <option data-bind-each-item="global.tags" data-bind-text="item.name" data-bind-value="item.oid"></option>
                                    </select>
                                    <select id="selection-create-tags-values" class="validate-data" data-validator="selection_create_form_validateValues">
                                        <option data-bind-each-item="tagValues" data-bind-text="item"></option>
                                    </select>
                                    <input type="button" value="Add" id="selection-create-tags-select-add" onclick="selection_create_form_addValue(); return false;"/>
                                    <span style="display: none;" class="validation-advice" id="advice-selection-create-tags-values">You must add at least one value.</span>
                                    <table id="selection-create-tags-table"> <!-- would be nice to hide it when it's empty with something like data-bind-show="selection.length"  but that doesn't quite work -->
                                        <caption>Selected Tags</caption>
                                        <thead>
                                            <tr>
                                                <th>Tag name</th>
                                                <th>Tag OID</th>
                                                <th>Tag Value</th>
                                                <!-- <th>Description</th> -->
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tfoot>
                                            <tr>
                                                <td colspan="4">
                                                    <a href="#">&lt; prev</a> | <a href="#">next 10 &gt;</a>
                                                    view&nbsp;<a href="#">5</a>&nbsp;<a href="#">10</a>&nbsp;<a href="#">25</a>&nbsp;<a href="#">50</a>&nbsp;<a href="#">100</a>&nbsp;per page
                                                </td></tr>
                                        </tfoot>
                                        <tbody>
                                            <tr data-bind-each-item="input.selection">
                                                <td data-bind-text="item.tag.name"></td>
                                                <td data-bind-text="item.tag.oid"></td>
                                                <td data-bind-text="item.value"></td>
                                                <td><a data-bind-tagOid="item.tag.oid" data-bind-tagValue="item.value" href="#" onclick="javascript:selection_create_form_removeValue(this.getAttribute('tagOid'),this.getAttribute('tagValue'));">remove</a></td>
                                            </tr>
                                        </tbody>
                                    </table>

                                </li>
                                <!-- <li><label for="tag-create-description">Tag description</label><input type="text" id="tag-create-description" name="description"/></li> -->
                                <li><input type="submit" value="Save" onclick="ws.createSelection(this); return false;"/></li>
                            </ul>
                        </form>

                        
                        <h2>Search Selections</h2>

                        <form id="selection-search-form" action="#" onsubmit="return false;">
                            <ul>
                                <li>
                                    <label for="selection-search-name">Name</label>
                                    <select id="selection-search-name-criteria">
                                        <option value="EqualTo">is</option>
                                        <option value="Contains">contains</option>
                                    </select>
                                    <input type="text" id="selection-search-name" name="name" placeholder="Name"/>
                                </li>
                                <!--   subject selection, when implement,  must support selecting more than one subject
                                <li>
                                    <label for="selection-search-subject">Subject (host uuid)</label>
                                    <select id="selection-search-subject-criteria">
                                        <option value="equalTo">is</option>
                                    </select>
                                    <input type="text" id="selection-search-subject" name="subject" placeholder="Subject"/>
                                </li>
                                -->
                                <li>
                                    <label for="selection-search-tagName">Tag name</label>
                                    <select id="selection-search-tagName-criteria">
                                        <option value="EqualTo">is</option>
                                        <option value="Contains">contains</option>
                                    </select>
                                    <input type="text" id="selection-search-tagName" name="tagName" placeholder="Tag name"/>
                                </li>
                                <li>
                                    <label for="selection-search-tagOid">Tag OID</label>
                                    <select id="selection-search-tagOid-criteria">
                                        <option value="EqualTo">is</option>
                                        <option value="StartsWith">starts with</option>
                                    </select>
                                    <input type="text" id="selection-search-tagOid" name="tagOid" placeholder="Tag OID"/>
                                </li>
                                <li>
                                    <label for="selection-search-tagValue">Tag value</label>
                                    <select id="selection-search-tagValue-criteria">
                                        <option value="EqualTo">is</option>
                                        <option value="Contains">contains</option>
                                    </select>
                                    <input type="text" id="selection-search-tagValue" name="tagValue" placeholder="Tag value"/>
                                </li>
                                <!--
                                <li>
                                    <label for="tag-search-description">Tag description</label>
                                    <select id="tag-search-description-criteria">
                                        <option>contains</option>
                                        <option>is</option>
                                    </select>
                                    <input type="text" id="tag-create-description" name="oid"/>
                                </li>
                                -->
                                <li><input type="button" value="Search..." onclick="ws.searchSelections(this); return false;"/></li>
                            </ul>
                        </form>

                        <h2>Browse Selections</h2>

                        <table id="selection-browse-table" class="dataview">
                            <caption>Selections</caption>
                            <thead>
                                <tr>
                                    <th>Selection Name</th>
                                    <!-- <th>Subjects (host uuids)</th> -->
                                    <th>Tags</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <td colspan="4">
                                        <a href="#">&lt; prev</a> | <a href="#">next 10 &gt;</a>
                                        view&nbsp;<a href="#">5</a>&nbsp;<a href="#">10</a>&nbsp;<a href="#">25</a>&nbsp;<a href="#">50</a>&nbsp;<a href="#">100</a>&nbsp;per page
                                    </td></tr>
                            </tfoot>
                            <tbody>
                                <tr data-bind-each-item="selections">
                                    <td data-bind-text="item.name"></td>
                                    <td>
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Tag Name</th>
                                                    <th>Tag Value</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr data-bind-each-item="item.tags">
                                                    <td data-bind-text="item.tagName"></td>
                                                    <td data-bind-text="item.tagValue"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                    <td><a data-bind-uuid="item.uuid" href="#" onclick="javascript:ws.removeSelection(this.getAttribute('uuid')); return false;">delete</a></td>
                                </tr>
                            </tbody>
                        </table>
                        
                        
                        
                        <!-- end selections tab -->
                    </div>

                    <div id="certificates">

                        <h1>Manage Certificates</h1>



                        <h2>Create New Certificate Request</h2>

                        <form id="certificate-request-create-form" action="#" onsubmit="return false;">
                            <ul>
                                <li><label for="certificate-request-create-subject">Subject</label>
                                    <input type="text" id="certificate-request-create-subject" name="subject" placeholder="Host UUID" data-bind-value="input.subject" class="required"/>
                                </li>
                                <li><label for="certificate-request-create-tag-selection">Tag Selection</label>
                                    <select id="certificate-request-create-tag-selection" data-bind-value="input.selection" class="required">
                                            <option data-bind-each-item="global.selections" data-bind-value="item.uuid" data-bind-text="item.name"></option>
                                    </select>
                                </li>
                                <!-- <li><label for="tag-create-description">Tag description</label><input type="text" id="tag-create-description" name="description"/></li> -->
                                <li><input type="submit" value="Save" onclick="ws.createCertificateRequest(this); return false;"/></li>
                            </ul>
                        </form>

                        <h2>Search Certificate Requests</h2>

                        <form id="certificate-request-search-form" action="#" onsubmit="return false;">
                            <ul>
                                <li>
                                    <label for="certificate-request-search-subject">Subject</label>
                                    <select id="certificate-request-search-subject-criteria">
                                        <option value="EqualTo">is</option>
                                    </select>
                                    <input type="text" id="certificate-request-search-subject" name="subject" placeholder="Host UUID"/>
                                </li>
                                <li>
                                    <label for="certificate-request-search-selection">Selection</label>
                                    <select id="certificate-request-search-selection-criteria">
                                        <option value="EqualTo">is</option>
                                    </select>
                                    <input type="text" id="certificate-request-search-selection" name="selection" placeholder="Selection Name or UUID"/>
                                </li>
                                <li>
                                    <label for="certificate-request-search-status">Status</label>
                                    <select id="certificate-request-search-status-criteria">
                                        <option value="EqualTo">is</option>
                                    </select>
                                    <select id="certificate-request-search-status">
                                        <option value=''>All</option>
                                        <option>New</option>
                                        <option>Pending</option>
                                        <option>Done</option>
                                        <option>Error</option>
                                    </select>
                                </li>
                                <li><input type="button" value="Search..." onclick="ws.searchCertificateRequests(this); return false;"/></li>
                            </ul>
                        </form>

                        <h2>Browse Certificate Requests</h2>

                        <table id="certificate-request-browse-table" class="dataview">
                            <caption>Certificate Requests</caption>
                            <thead>
                                <tr>
                                    <th>Subject (host uuid)</th>
                                    <th>Selection</th>
                                    <th>Status</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <td colspan="4">
                                        <a href="#">&lt; prev</a> | <a href="#">next 10 &gt;</a>
                                        view&nbsp;<a href="#">5</a>&nbsp;<a href="#">10</a>&nbsp;<a href="#">25</a>&nbsp;<a href="#">50</a>&nbsp;<a href="#">100</a>&nbsp;per page
                                    </td></tr>
                            </tfoot>
                            <tbody>
                                <tr data-bind-each-item="certificateRequests">
                                    <td data-bind-text="item.subject"></td>
                                    <td data-bind-text="item.selection"></td>
                                    <td data-bind-text="item.status"></td>
                                    <td><a data-bind-uuid="item.uuid" href="#" onclick="javascript:ws.removeCertificateRequest(this.getAttribute('uuid')); return false;">delete</a></td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <h2>Search Certificates</h2>

                        <form id="certificate-search-form" action="#" onsubmit="return false;">
                            <ul>
                                <li>
                                    <label for="certificate-search-subject">Subject</label>
                                    <select id="certificate-search-subject-criteria">
                                        <option value="EqualTo">is</option>
                                        <option value="Contains">contains</option>
                                    </select>
                                    <input type="text" id="certificate-search-subject" name="subject" placeholder="Host UUID"/>
                                </li>
                                <li>
                                    <label for="certificate-search-issuer">Issuer</label>
                                    <select id="certificate-search-issuer-criteria">
                                        <option value="EqualTo">is</option>
                                        <option value="Contains">contains</option>
                                    </select>
                                    <input type="text" id="certificate-search-issuer" name="issuer" placeholder="Issuer name"/>
                                </li>
                                <li>
                                    <label for="certificate-search-valid">Validity Date</label>
                                    <select id="certificate-search-valid-criteria">
                                        <option value="On">on</option>
                                        <option value="Before">before</option>
                                        <option value="After">after</option>
                                    </select>
                                    <input type="text" id="certificate-search-valid" name="valid" placeholder="Date" onblur='$(this).value = Date.parse($(this).value).toISOString();'/>
                                    <span class="help">Try "today", "next tuesday", or most reasonable date formats</span>
                                </li>
                                <li>
                                    <label for="certificate-search-sha1">SHA-1</label>
                                    <!-- <input type="hidden" id="certificate-search-sha1-criteria" value="Hex"/> -->
                                    <input type="text" id="certificate-search-sha1" name="sha1" placeholder="Hex (40 characters)"/>
                                </li>
                                <li>
                                    <label for="certificate-search-sha256">SHA256</label>
                                    <!-- <input type="hidden" id="certificate-search-sha256-criteria" value="Hex"/> -->
                                    <input type="text" id="certificate-search-sha256" name="sha256" placeholder="Hex (64 characters)"/>
                                </li>
                                <li>
                                    <label for="certificate-search-pcrEvent">PCR Event</label>
                                    <!-- <input type="hidden" id="certificate-search-pcrEvent-criteria" value="Hex"/> -->
                                    <input type="text" id="certificate-search-pcrEvent" name="pcrEvent" placeholder="Hex (40 characters)"/>
                                </li>
                                <li>
                                    <label for="certificate-search-revoked">Status</label>
                                    <input type="hidden" id="certificate-search-revoked-criteria" value=""/>
                                    <select id="certificate-search-revoked">
                                        <option value="">Any</option>
                                        <option value="false">Active</option>
                                        <option value="true">Revoked</option>
                                    </select>
                                </li>
                                
                                <!--
                                <li>
                                    <label for="certificate-search-selection">Selection</label>
                                    <select id="certificate-search-selection-criteria">
                                        <option value="EqualTo">is</option>
                                    </select>
                                    <input type="text" id="certificate-search-selection" name="selection" placeholder="Selection Name or UUID"/>
                                </li>
                                <li>
                                    <label for="certificate-search-status">Status</label>
                                    <select id="certificate-search-status-criteria">
                                        <option value="EqualTo">is</option>
                                    </select>
                                    <select id="certificate-search-status">
                                        <option value=''>All</option>
                                        <option>New</option>
                                        <option>Pending</option>
                                        <option>Done</option>
                                        <option>Error</option>
                                    </select>
                                </li>
                                -->
                                <li><input type="button" value="Search..." onclick="ws.searchCertificates(this); return false;"/></li>
                            </ul>
                        </form>
                                                

                        
                        <h2>Browse Certificates</h2>
                        <table id="certificate-browse-table" class="dataview">
                            <thead>
                                <tr>
                                    <th>Subject (Host ID)</th>
                                    <th>Issuer</th>
                                    <th style="width: 40px;">Not Before</th>
                                    <th style="width: 40px;">Not After</th>
                                    <th>Status</th>
                                    <th>Fingerprint (SHA-1)</th>
                                    <th>Fingerprint (SHA256)</th>
                                    <th>Certificate</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <td colspan="5">
                                        <a href="#">&lt; prev</a> | <a href="#">next 10 &gt;</a>
                                        view&nbsp;<a href="#">5</a>&nbsp;<a href="#">10</a>&nbsp;<a href="#">25</a>&nbsp;<a href="#">50</a>&nbsp;<a href="#">100</a>&nbsp;per page
                                    </td></tr>
                            </tfoot>
                            <tbody>
                                <tr data-bind-each-item="certificates">
                                    <td data-bind-text="item.subject"></td>
                                    <td data-bind-text="item.issuer"></td>
                                    <td data-bind-text="item.notBefore | date"></td>
                                    <td data-bind-text="item.notAfter | date"></td>
                                    <td data-bind-text="item.revoked | yesno Revoked Active"></td>
                                    <td data-bind-text="item.sha1 | wrap 16"></td>
                                    <td data-bind-text="item.sha256 | wrap 16"></td>
                                    <td>
                                        <a href="" onmouseover="$(this).href='data:application/octet-stream;base64,'+($(this).next('span').innerHTML);">download</a><span style="display:none;" data-bind-text="item.certificate"></span> <br/>
                                        <a data-bind-uuid="item.uuid" href="#" onclick="javascript:ws.deleteCertificate(this.getAttribute('uuid')); return false;">delete</a> <br/>
                                        <a data-bind-uuid="item.uuid" href="#" onclick="javascript:ws.revokeCertificate(this.getAttribute('uuid')); return false;">revoke</a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        
                    </div> <!-- end certificates tab -->

                    <div id="rdf">
                        <h1>Tag Policy Management</h1>


                        <h2>Create New RDF Triple</h2>

                        <form id="rdf-triple-create-form">
                            <ul>
                                <li><label for="rdf-triple-create-subject">Subject</label><input type="text" id="rdf-triple-create-subject" data-bind-value="input.subject" name="subject" placeholder="ID"/></li>
                                <li><label for="rdf-triple-create-predicate">Predicate</label><input type="text" id="rdf-triple-create-predicate" data-bind-value="input.predicate" name="predicate" placeholder="Attribute name"/></li>
                                <li><label for="rdf-triple-create-object">Object</label><input type="text" id="rdf-triple-create-object" data-bind-value="input.object" name="object" placeholder="Attribute value"/></li>
                                <li><input type="button" value="Save" onclick="ws.createRdfTriple(this); return false;"/></li>
                            </ul>
                        </form>

                        <h2>Search RDF Triples</h2>

                        <form id="rdf-triple-search-form" action="#" onsubmit="return false;">
                            <ul>
                                <li>
                                    <label for="rdf-triple-search-subject">Subject (id)</label>
                                    <select id="rdf-triple-search-subject-criteria">
                                        <option value="EqualTo">is</option>
                                        <option value="Contains">contains</option>
                                    </select>
                                    <input type="text" id="rdf-triple-search-subject" name="subject" placeholder="ID"/>
                                </li>
                                <li>
                                    <label for="rdf-triple-search-predicate">Predicate</label>
                                    <select id="rdf-triple-search-predicate-criteria">
                                        <option value="EqualTo">is</option>
                                        <option value="Contains">contains</option>
                                    </select>
                                    <input type="text" id="rdf-triple-search-predicate" name="predicate" placeholder="Attribute name"/>
                                </li>
                                <li>
                                    <label for="rdf-triple-search-object">Object</label>
                                    <select id="rdf-triple-search-object-criteria">
                                        <option value="EqualTo">is</option>
                                        <option value="Contains">contains</option>
                                    </select>
                                    <input type="text" id="rdf-triple-search-object" name="object" placeholder="Attribute value"/>
                                </li>
                                <!--
                                <li>
                                    <label for="rdf-triple-search-description">Rdf Triple description</label>
                                    <select id="rdf-triple-search-description-criteria">
                                        <option>contains</option>
                                        <option>is</option>
                                    </select>
                                    <input type="text" id="rdf-triple-create-description" name="predicate"/>
                                </li>
                                -->
                                <li><input type="button" value="Search..." onclick="ws.searchRdfTriples(this); return false;"/></li>
                            </ul>
                        </form>

                        <h2>Browse RDF Triples</h2>

                        <table id="rdf-triple-browse-table" class="dataview">
                            <caption>RDF Triples</caption>
                            <thead>
                                <tr>
                                    <th>Subject (id)</th>
                                    <th>Predicate (attribute name)</th>
                                    <th>Object (attribute value)</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr> <td colspan="4">
                                        <a href="#">&lt; prev</a> | <a href="#">next 10 &gt;</a>
                                        view&nbsp;<a href="#">5</a>&nbsp;<a href="#">10</a>&nbsp;<a href="#">25</a>&nbsp;<a href="#">50</a>&nbsp;<a href="#">100</a>&nbsp;per page
                                    </td></tr>
                            </tfoot>
                            <tbody>
                                <tr data-bind-each-item="rdfTriples">
                                    <td data-bind-text="item.subject"></td>
                                    <td data-bind-text="item.predicate"></td>
                                    <td data-bind-text="item.object"></td>
                                    <td><a data-bind-uuid="item.uuid" href="#" onclick="javascript:ws.removeRdfTriple(this.getAttribute('uuid')); return false;">delete</a></td>
                                </tr>
                            </tbody>
                        </table>
                        <!-- end rdf tab -->
                    </div>


                    <div id="configure">
                        
                        <form id="configuration-search-form" style="display: none;" onsubmit="return false;">
                            <ul>
                                <li>
                                    <label for="configuration-search-name">Name</label>
                                    <select id="configuration-search-name-criteria">
                                        <option value="EqualTo">is</option>
                                        <option value="Contains">contains</option>
                                    </select>
                                    <input type="text" id="configuration-search-name" name="name" placeholder="Configuration name, eg 'main'"/>
                                </li>
                                <li style="display: none;">
                                    <label for="configuration-search-contentType">Content Type</label>
                                    <input type="hidden" id="configuration-search-contentType-criteria" value="EqualTo"/>
                                    <select id="configuration-search-contentType">
                                        <option>JSON</option>
                                    </select>
                                </li>
                                <li><input type="button" value="Search..." onclick="ws.searchConfigurations(this); return false;"/></li>
                            </ul>
                        </form>
                        
                        <form id="config-form" onsubmit="return false;">
                            <input type="button" id="config-save-button" value="Save" onclick="ws.storeMainConfiguration(this); return false;"/>
                            <input type="button" id="config-load-button" value="Reset" onclick="ws.retrieveMainConfiguration(); return false;"/>

                                <!--
                                <h2>Local Data</h2>
                                <ul>
                                <li><label for="mhclient-config-json">MHCLIENT_CONFIG</label> <input type="text" size="80" id="mhclient-config-json" value="C:\Users\jbuhacof\.mystery-hill\client\client-html5-config.json"/></li>
                                <li><label for="mhclient-home-dir">MHCLIENT_HOME</label> <input type="text" size="80" id="mhclient-home-dir" value="C:\Users\jbuhacof\workspace\mystery-hill\client\target"/> location of mhclient.jar</li>
                                <li><label for="mhclient-image-dir">MHCLIENT_IMAGES</label> <input type="text" size="80" id="mhclient-image-dir" value="C:\Users\jbuhacof\Downloads\VM Images"/></li>
                                <li><label for="mhclient-encrypted-image-dir">MHCLIENT_ENC_IMAGES</label> <input type="text" size="80" id="mhclient-encrypted-image-dir" value="C:\Users\jbuhacof\Downloads\VM Encrypted Images"/></li>
                                </ul>
                                -->
                                <!--
                            <fieldset><legend>Client Configuration</legend>

                                <br/>
                                <h2>Web Services</h2>
                                <ul>
                                    <li><label for="provsvc">MTWILSON_ATAG_PROVSVC_URL</label> <input type="text" size="80" id="provsvc" value="https://localhost:8080" placeholder="URL"/></li>
                                </ul>
                            </fieldset> -->
                            <fieldset><legend>Server Configuration</legend>
                                <br/>
                                <!--
                                <h2>Local Data</h2>
                                <ul>
                                <li><label for="mhclient-config-json">MHCLIENT_CONFIG</label> <input type="text" size="80" id="mhclient-config-json" value="C:\Users\jbuhacof\.mystery-hill\client\client-html5-config.json"/></li>
                                <li><label for="mhclient-home-dir">MHCLIENT_HOME</label> <input type="text" size="80" id="mhclient-home-dir" value="C:\Users\jbuhacof\workspace\mystery-hill\client\target"/> location of mhclient.jar</li>
                                <li><label for="mhclient-image-dir">MHCLIENT_IMAGES</label> <input type="text" size="80" id="mhclient-image-dir" value="C:\Users\jbuhacof\Downloads\VM Images"/></li>
                                <li><label for="mhclient-encrypted-image-dir">MHCLIENT_ENC_IMAGES</label> <input type="text" size="80" id="mhclient-encrypted-image-dir" value="C:\Users\jbuhacof\Downloads\VM Encrypted Images"/></li>
                                </ul>
                                -->
                                <h2>Provisioning</h2>
                                <ul>
                                    <li>
                                        <label for="allow-tags-in-certificate-requests">Allow tag selections in certificate requests</label>
                                        <select data-bind-value="input.allowTagsInCertificateRequests" id="allow-tags-in-certificate-requests" name="allowTagsInCertificateRequests">
                                            <option value="true">Yes</option>
                                            <option value="false">No</option>
                                        </select>
                                        <p>Choosing 'Yes' here enables the "Manual" and "Automatic Host-Based" provisioning request models.
                                        Note: for "Automatic Host-Based" provisioning you also need to configure a code signing certificate.</p>
                                    </li>
                                    <li>
                                        <label for="allow-automatic-tag-selection">Allow server to automatically select tags for certificate requests</label>
                                        <select data-bind-value="input.allowAutomaticTagSelection"  id="allow-automatic-tag-selection" name="allowAutomaticTagSelection">
                                            <option value="true">Yes</option>
                                            <option value="false">No</option>
                                        </select>
                                        <p>Choosing 'Yes' here enables the "Automatic Server-Based" provisioning request models.
                                        Note: for "Automatic Server-Based" provisioning you also need to set a tag selection policy.</p>
                                    </li>
                                    <li>
                                        <label for="automatic-tag-selection-name">Choose a tag selection to use for all certificate requests</label>
                                        <!-- bind value below for the option used to be item.uuid but it's conveinnt to configure wiht human-readable name ... XXX solve this later by making the sample data use the uuid not the name when it configures -->
                                        <select data-bind-value="input.automaticTagSelectionName"  id="automatic-tag-selection-name" name="automaticTagSelectionName">
                                            <option data-bind-each-item="global.selections" data-bind-value="item.uuid" data-bind-text="item.name"></option> 
                                        </select>
                                        <p>If you use "Automatic Server-Based" provisioning, the server needs to know which tag selection
                                        to use for incoming certificate requests. Currently only one tag selection is supported.</p>
                                    </li>
                                    <li><label for="approval-method">Approval Method</label> 
                                        <select  data-bind-value="input.approveAllCertificateRequests"  id="approval-method" name="approveAllCertificateRequests">
                                            <option value="true">Automatic/internal</option>
                                            <option value="false">Manual/external</option>
                                        </select>
                                    </li>
                                </ul>
                            </fieldset>
                            
                                <fieldset>
                                    <legend>Mt Wilson</legend>
                                    <ul>
                                        <li>
                                            <label for="mtwilson-url">MtWilson URL</label>
                                            <input type="text" data-bind-value="mtwilsonUrl" id="mtwilson-url" name="mtwilsonUrl" class="validate-url"/>
                                        </li>
                                        <li>
                                            <label for="mtwilson-client-keystore-username">MtWilson Client Username</label>
                                            <input type="text" data-bind-value="mtwilsonClientKeystoreUsername" id="mtwilson-client-keystore-username" name="mtwilsonClientKeystoreUsername"/>
                                        </li>
                                        <li>
                                            <label for="mtwilson-client-keystore-password">MtWilson Client Password</label>
                                            <input type="password" data-bind-value="mtwilsonClientKeystorePassword" id="mtwilson-client-keystore-password" name="mtwilsonClientKeystorePassword"/>
                                        </li>
                                    </ul>                                    
                                </fieldset>

                        </form>

                          <!-- since there is a create-ca-key command now, disabling this forma nd just showing the cacerts for import to mt wilson -->
                        <form id="ca-update-form">
                            <fieldset>
                                <legend>Certificate Authority</legend>
                                <p>A certificate authority is automatically created during a new install. 
                                    You can update the authority information here. Updating the authority information
                                    will cause the existing certificate authority to be revoked and a new one to be
                                    created with the updated information.</p>
                                <p>To create a new CA, use the "create-ca-key" command on the asset tag server.</p>
                                <ul style="display: none;"> 
                                    <li><label for="ca-cn">Common Name</label><input type="text" id="ca-cn" size="30" data-bind-value="input.cn" placeholder="First Name &amp; Last Name" class="required"/></li>
                                    <li><label for="ca-ou">Organizational Unit</label><input type="text" id="ca-ou" size="30" data-bind-value="input.ou" placeholder="Department" value="Cloud Security" class="required"/></li>
                                    <li><label for="ca-o">Organization</label><input type="text" id="ca-o" size="30" data-bind-value="input.o" placeholder="Organization or Company" value="Intel" class="required"/></li>
                                    <li><label for="ca-l">Locality</label><input type="text" id="ca-l" size="30" data-bind-value="input.l" placeholder="City" value="Folsom" class="required"/></li>
                                    <li><label for="ca-st">State</label><input type="text" id="ca-st" size="30" data-bind-value="input.st" placeholder="State or Province" value="CA" class="required"/></li>
                                    <li><label for="ca-c">Country</label><input type="text" id="ca-c" size="30" data-bind-value="input.c" placeholder="Country" value="US" class="required"/></li>
                                    <li><input type="button" value="Update" onclick="ws.updateCertificateAuthority(this);"/></li>
                                </ul>
                                <!-- not using data binding right now because we're not supporting updating the file... but we will later to allow user to import external ca certs by just appending them here -->
                                <textarea id="cacerts-text" rows='20' cols='80'></textarea>
                            </fieldset>
                        </form>
                          
                        <!-- end configure tab -->
                    </div>
                </div>

                <div id="log">
                    <h1>Application Log</h1>
                    <div id="logwindow" style="height: 250px; max-height: 250px; overflow: scroll; border: 2px solid #555555; margin-top: 15px; padding: 4px;">
                    </div>
                    <!-- end log tab -->
                </div>
                <!-- content-wrap ends-->	
            </div>

            
            <!-- footer starts -->			
            <div id="footer-wrap"><div id="footer">				

                    <p>
                        &copy; 2013 Intel Corporation
                    </p>

                </div></div>
            <!-- footer ends-->	

            <!-- wrap ends here -->
        </div>

        <!-- configure javascript logging -->								
        <script>
            log.attach("logwindow");
        </script>

        <!-- script must be at the end of the markup so it can reference any element -->
        <script>
            // this section initializes the user interface   
            var navTabs = new Control.Tabs('navtabs', {
                activeClassName: 'current',
                setClassOnContainer: true,
                afterChange: function(new_container) {
                    if(new_container.id == 'tags') {
                        //                        onUpdateVoterIssues();
                    }
                    if(new_container.id == 'certificates') {
                        //                        onDisplayTally();
                    }
                }
            });
            navTabs.setActiveTab('tags');
//            navTabs.setActiveTab('certificates');  // XXX for debugging only; normally start with 'tags''
            //$('ajaxstatus').hide();
        </script>


        <script>
            //log.debug("adapter: "+rivets_watch_findx_adapter);
            //rivets-test
            //var taglist = [ {name:"tag1",oid:"1.1"}, {name:"tag2",oid:"2.2" } ];
            //var taglist = [ "hello", "world" ];
            //var taglist = [ [{name:"hello"}, {name:"world"}] ];
            //var myview = rivets.bind(document.getElementById('rivets-test'), { tags: [ {item:"hello"},{item:"world"}] }); // instead of sampledata.tags
            // *** these were enabled ***
            var alertView, tagview, rdfview, selectionview, tagviewCertificateRequests, certificateView /*, appview */, configurationView;
            //
            //taglist.push("test");
            //myview.build();
            //mybindings.update({filter: mytags});
            //sampledata.tags.push({"name":"new tag","oid":"1.2.3.4","values":["hello","world"]});
            // make sure all dom elements are loaded before initializing the web layer
            document.observe('dom:loaded', function() {
                ws.initialize({
                    options: {
                        baseurl: 'http://localhost:8080'
                    }
                    //views: { 'tags': tagview, 'rdf-triples': rdfview }
    //                data: sampledata, // optional: if not provided will start empty and then we can load it from server
    /*
                    view: { 'update': function(data) {
                            var i = mtwilson.rivets.views.length; // until they respond we don't know what these tags are;  TODO if user changes here make sure yo uupdate config in database
                            while(i--) {
                                mtwilson.rivets.views[i].update(data);
                            }
    // //                     appview.update(data); 
    //                        tagview.update(data);
    //                        rdfview.update(data);
    //                        selectionview.update(data);
    //  //                      tagviewCertificateRequests.update(data);
    //                        certificateView.update(data); 
    //                        configurationView.update(data);
                        },
                        'sync': function() {
                            var i = mtwilson.rivets.views.length; // until they respond we don't know what these tags are;  TODO if user changes here make sure yo uupdate config in database
                            while(i--) {
                                mtwilson.rivets.views[i].sync();
                            }
    ////                        appview.sync(); 
    //                        tagview.sync();
    //                        rdfview.sync();
    //                        selectionview.sync();
    // //                       tagviewCertificateRequests.sync();
    //                        certificateView.sync(); 
    //                        configurationView.sync();
                        }
                    }*/
                });
                log.debug("done initializing ws");
            });
            
            //alertView = rivets.bind(document.getElementById('notifications'), ws.data);

//            appview = rivets.bind(document.getElementById('main'), ws.data); 
//            tagview = rivets.bind(document.getElementById('tag-browse-table'), ws.data); 
//            rdfview = rivets.bind(document.getElementById('rdf-triple-browse-table'), ws.data); 
//            selectionview = rivets.bind(document.getElementById('selection-browse-table'), ws.data); 
////            tagviewCertificateRequests = rivets.bind(document.getElementById('certificate-request-create-form'), ws.data); 
//            certificateView = rivets.bind(document.getElementById('certificate-browse-table'), ws.data); 
//            configurationView = rivets.bind(document.getElementById('config-form'), ws.data.currentConfiguration); 

            // wait for the webservice library to initialize, then populate the UI with some data from the server. 
            // XXX TODO create special 'views' resources on the  server that can provide all the info
            // we need in one response. so for example the default search for tags, triples, and selections, as well
            // as main configuration and cacerts... all would be defined in one 'view' that would be merged into
            // mtwilson.data. 
            document.observe('mtwilson:ready', function() {
                log.debug("after init (mtwilson:ready), data: "+Object.toJSON(ws.data));
                ws.searchTags('tag-search-form');
                ws.searchRdfTriples('rdf-triple-search-form');
                ws.searchSelections('selection-search-form');
                ws.searchConfigurations('configuration-search-form');
                ws.loadCaCerts();
//                ws.retrieveMainConfiguration();
            
            });
        </script>

    </body>
</html>
